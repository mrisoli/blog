import Post from '../../components/layouts/post'
import Header from '../../components/post/header'
import H2 from '../../components/post/heading'
import P from '../../components/post/paragraph'

const Article = () => (
  <Post>
    <Header
      title="Accountability, Motivation and Slackbots"
      date="December 23, 2020"
    />

    <P>
      I've been playing with Slack applications and chatbots for a while now, I
      find Slack to be a very interesting frontend for content that can be
      interacted with through a group with shared interest, they can be useful
      to keep every one up to date on work matters or automate some process, as
      well as have fun in more casual Slack channels.
    </P>

    <P>
      Earlier this year, before there were any restrictions many of us in a
      particular Slack group was taking up running as a way to get fit, we
      discovered{' '}
      <a href={links[0]} target="_blank">
        Strava
      </a>{' '}
      had a feature for groups where we could compete in a leaderboard as a way
      to motivate each other.
    </P>

    <P>
      With a channel dedicated to discuss running and fitness I looked into
      integrating Strava and Slack so we could bring our club's result into the
      channel, turns out this was quite easy with{' '}
      <a href={links[1]} target="_blank">
        Zapier
      </a>
      , with a few clicks we quickly had a message on the channel whenever
      someone posted a new activity:
    </P>

    <img
      src="/stravabot.png"
      alt="screenshot of slack message with Strava run details"
    />

    <P>
      I also found{' '}
      <a href={links[2]} target="_blank">
        Slava
      </a>
      , an independent app which fullfills the same purpose with slightly better
      formatted messages:
    </P>
    <img
      src="/slava.png"
      alt="screenshot of slack message with Slava message"
    />

    <P>
      It was a major hit, Slack messages kept our activities as continuous
      points and made us motivate each other, throughout the year the Strava
      club accrued more than 500 activities from 16 members totalling over
      2000km and we continue to post new runs multiple times a day.
    </P>

    <H2 id="advent-of-code">Advent of Code</H2>

    <P>
      Later on the year, as one of my favorite holiday season traditions start,{' '}
      <a href={links[3]} target="_blank">
        Advent of Code
      </a>
      , I thought if maybe the same formula would work, so I decided to create a
      Slack app to notify our channel whenever someone completed one of the
      puzzles
    </P>

    <P>
      While there were no ready-made integrations or Zapier apps for this, it
      shouldn't be so hard to create one, I decided to try it myself since the
      whole activity is about coding anyway, so to speed things up I thought
      about giving serverless functions with Amazon Lambda a go.
    </P>

    <P>
      Since Advent of Code has a pretty simple API for private leaderboards, it
      was easy enough to just query the API and filter all the completions with
      a timestamp larger than the previous time checked, then format the message
      and post to a Slack webhook, so I wrote a{' '}
      <a href={links[4]} target="_blank">
        simple Python function
      </a>
      .
    </P>

    <P>
      To get it working all that is necessary is exporting a YEAR variable(for
      the year to checked), a LEADERBOARD_ID variable, which can be found in the
      leaderboard's page, the COOKIE from advent of code which can be obtained
      from the browser, and a SLACK_WEBHOOK_URL which is generated by creating
      an app for your Slack group.
    </P>

    <P>
      After copy-pasting the code into AWS Lambda, I needed a way to trigger the
      function to run, this can be done with a rule in AWS Event Bridge that
      runs the following cron expression:
    </P>

    <P>0/15 * ? DEC * *</P>

    <P>
      This expression simply means to run the function every 15 minutes(starting
      from minute zero)every hour of every day during December, it's recommended
      by Advent of Code creator to not poll excessively so 15 minutes should be
      more than enough to get up to date data.
    </P>

    <P>And sure enough, it works:</P>

    <img
      src="/advcodebot.png"
      alt="Screenshot of Slack with advent of code message"
    />

    <P>
      We didn't have as many people doing Advent of code as running, so this
      didn't exactly get as many people motivated, but it worked for me, I
      managed to get further into this years puzzles than ever before. You can
      check my Advent of Code puzzle solutions{' '}
      <a href={links[5]} target="_blank">
        here
      </a>
      .
    </P>
  </Post>
)

const links = [
  'https://strava.com/',
  'https://zapier.com/',
  'https://slava.playplay.io/',
  'https://gist.github.com/mrisoli/6fe4d6e6acf6538a406de83570e187b3',
  'https://github.com/mrisoli/adventofcode',
]

export default Article
